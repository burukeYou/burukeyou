<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="burukeyou.admin.mapper.UmsAdminMapper" >
    <select id="getListByCondition" resultMap="roleOfUser" parameterType="burukeyou.admin.entity.dto.QueryUserConditionDto">
            SELECT admin.id ,admin.nickname,admin.mobile,admin.email,admin.avatar,admin.description,admin.deleted
                   admin.enabled,admin.create_host,admin.lastlogin_host,admin.lastlogin_time,admin.created_by,admin.created_time
                   admin.updated_by,admin.updated_time
                   role.id as roleId,role.code,role.name,role.description as rDescription
            from ums_admin admin join ums_admin_role_relation ad_ro on admin.id = ad_ro.user_id and role_type = 'role'
            JOIN ums_roles role  on ad_ro.role_id = role.id
            <where>
                <if test="condition != null and condition != ''">
                    and (
                            admin.admin_name like CONCAT('%',#{condition},'%') OR
                            admin.nickname like CONCAT('%',#{condition},'%') OR
                            admin.description like CONCAT('%',#{condition},'%')
                        )
                </if>
                <if test="role  != null and role != ''">
                    and role.name = #{role}
                </if>
                <if test="enabled  != null and enabled != ''">
                    and admin.enabled = #{enabled}
                </if>
            </where>
         <!--   <choose>
                <when test="'nickname' == orderField">
                    order by admin.nickname
                </when>
                <when test="……">
                    order by
                </when>
                <when test="……">
                    order by
                </when>
                <otherwise>
                    order by admin.id
                </otherwise>
            </choose>
-->

    </select>
    <resultMap id="roleOfUser" type="burukeyou.admin.entity.vo.UmsAdminVO">
        <id property="id" column="uId"/>
        <result property="nickname" column="username"/>
        <result property="mobile" column="nickname"/>
        <result property="email" column="email"/>
        <result property="avatar" column="password"/>
        <result property="description" column="avatar"/>
        <result property="deleted" column="enabled"/>
        <result property="enabled" column="accountNonExpired"/>
        <result property="createHost" column="accountNonLocked"/>
        <result property="lastloginHost" column="credentialsNonExpired"/>
        <result property="lastloginTime" column="credentialsNonExpired"/>
        <result property="createdBy" column="credentialsNonExpired"/>
        <result property="createdTime" column="credentialsNonExpired"/>
        <result property="updatedBy" column="credentialsNonExpired"/>
        <result property="updatedTime" column="credentialsNonExpired"/>


        <collection property="roleList" ofType="burukeyou.admin.entity.vo.UmsRoleVO">
            <id property="id" column="roleId"/>
            <result property="code" column="code"/>
            <result property="name" column="name"/>
            <result property="description" column="rDescription"/>
        </collection>
    </resultMap>
</mapper>